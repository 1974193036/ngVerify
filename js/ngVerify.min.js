/**
 * ngVerify v1.2.8
 *
 * @license: MIT
 * Designed and built by Moer
 * github   https://github.com/Moerj/ngVerify
 *
 */
!function(angular){function isEmptyObject(e){if("object"!=typeof e)return!1;var r;for(r in e)return!1;return!0}function formatOpt(str,iElm){"{"!=str.charAt(0)&&(str="{"+str+"}");try{return eval("("+str+")")}catch(e){console.error("ngVerify options has error:"),console.error(iElm)}}function Init(e){var r=e.ngVerify.$scope,t=e.ngVerify.iAttrs,n=e.ngVerify.OPTS,i={message:"此项为必填",required:!0,option:0,min:t.minlength,max:t.maxlength,errorClass:"verifyError",disabled:!0,least:1,tipStyle:r.ngVerify.tipStyle>=0?r.ngVerify.tipStyle:1};if("radio"==t.type&&n.least&&(console.warn("least is not radio's effective parameter:"),console.warn(e),n.least=i.least),n=angular.extend({},i,n),e.ngVerify.OPTS=n,e.attr({maxlength:n.max,minlength:n.min}),n.control||"submit"==t.type)r.ngVerify.subBtn.push(e),setTimeout(function(){n.disabled&&checkAll(r.ngVerify.elems).hasError&&e.attr("disabled",!0),e.on("click",function(t){t.stopPropagation(),e.attr("disabled")||r.ngVerify.submit()})});else{var o="checkbox"==t.type||"radio"==t.type,a='<div class="verifyTips"><p class="tipStyle-'+n.tipStyle+'"><span class="tipMsg"></span><i></i></p></div>',l=e.parent();if(o&&"label"==l[0].localName?(l=l.parent(),l.append(a)):e.after(a),e.ngVerify.errtip={tip:angular.element(l[0].querySelector(".verifyTips > p")),message:angular.element(l[0].querySelector(".verifyTips .tipMsg"))},"textarea"==e[0].localName&&1==n.tipStyle&&e.on("click",function(){return e.ngVerify.errtip.tip.css("top",-1*e[0].offsetHeight+"px"),!1}),r.ngVerify.elems.push(e),bindVaild(e),o)for(var s=document.getElementsByName(t.name),c=0;c<s.length;c++)s[c]!=e[0]&&angular.element(s[c]).on("blur",function(){e.triggerHandler("blur")}).on("change",function(){e.triggerHandler("change")})}}function bindVaild(e){var r=e.ngVerify.$scope,t=e.ngVerify.scope,n=e.ngVerify.iAttrs;n.ngModel&&t.$watch(n.ngModel,function(r,t){null==r&&null==t||(null==r||isEmptyObject(r)?e.ngVerify.modelValue=null:e.ngVerify.modelValue="number"==n.type?Number(r):String(r),"select"==e[0].localName?r?e.triggerHandler("keyup"):e.triggerHandler("blur"):void 0===e[0].value?e.triggerHandler("click"):e.triggerHandler("change"))}),"radio"!=n.type&&"checkbox"!=n.type&&e.on("focus",function(){e.ngVerify.invalid&&tipMsg(e,!0)});var i="",o="";void 0===e[0].value?(i="blur",o="click keyup",e.attr("tabindex",0),e.on(o,function(){setTimeout(function(){e[0].focus()})})):"radio"==n.type||"checkbox"==n.type?(i="blur",o="change"):(i="blur",o="change keyup"),e.on(i,function(){ISVALID(e)||(tipMsg(e,!1),makeError(e,!0),DisableButtons(r.ngVerify.subBtn,!0))}).on(o,function(){if(ISVALID(e)){tipMsg(e,!1),makeError(e,!1);var t=checkAll(r.ngVerify.elems);t.hasError||DisableButtons(r.ngVerify.subBtn,!1)}else e.ngVerify.invalid&&tipMsg(e,!0)})}function tipMsg(e,r){var t=e.ngVerify.OPTS;if(0!=t.tipStyle){var n=e.ngVerify.errtip,i=t.errmsg?t.errmsg:t.message;e[0]._verifySetError&&(i=e[0]._verifySetError),n.message.text(i),n.tip.toggleClass("showTip-"+t.tipStyle,r),1==t.tipStyle&&n.tip.css("top",-1*e[0].offsetHeight+"px")}}function makeError(e,r){var t=e.ngVerify.OPTS.errorClass,n=e.parent();e.ngVerify.invalid=r,"checkbox"!=e[0].type&&"radio"!=e[0].type||("label"==n[0].localName&&(n=n.parent()),e=n,e.toggleClass(t+"-dash",r)),e.toggleClass(t,r)}function DisableButtons(e,r){for(var t=0;t<e.length;t++)e[t].ngVerify.OPTS.disabled&&e[t].attr("disabled",r)}function ISVALID(e){if("none"==e[0].style.display)return!0;if(e[0]._verifySetError)return!1;var r,t,n=e.ngVerify.iAttrs,i=e.ngVerify.OPTS;if("checkbox"==n.type||"radio"==n.type){for(var o=document.getElementsByName(e.attr("name")),a=0,l=0;l<o.length;l++)o[l].checked&&a++;return a>=i.least?!0:(i.message="至少选择"+i.least+"项",!1)}if("select"==e[0].localName)return e[0].selectedIndex===i.option?(i.message="请选择",!1):!0;if(t=void 0!==e[0].value?null!=e.val()?e.val():e.ngVerify.modelValue:n.ngModel?e.ngVerify.modelValue:e.text(),null==t&&(t=""),t=t.trim(),i.required&&""==t)return"number"==n.type?i.message="需输入数字":i.message="不能为空",!1;if(!i.required&&""==t)return!0;if(t.length<i.min)return i.message="最少"+i.min+"个字符",!1;if(t.length>i.max)return i.message="最多"+i.max+"个字符",!1;if(i.pattern)r=i.pattern;else switch(n.type){case"number":r=/\d/,r.name="数字";break;case"email":r=/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/,r.name="邮箱";break;case"phone":r=/^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,r.name="手机号";break;case"url":r=/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:\/~\+#]*[\w\-\@?^=%&amp;\/~\+#])?/,r.name="链接";break;case"char":r=/^[A-Za-z_]+$/,r.name="字符"}return r&&null==t.match(r)?(i.message=r.name+"格式错误",!1):!0}function checkAll(e){for(var r={hasError:!1,errEls:[]},t=0;t<e.length;t++)ISVALID(e[t])||r.errEls.push(e[t]);return r.hasError=!!r.errEls.length,r}var m=angular.module("ngVerify",[]);m.service("ngVerify",function(){return{scope:function(e){for(var r,t=document.getElementsByName(e),n=0;n<t.length;n++)if(t[n]._verifyScope){r=t[n]._verifyScope;break}return r},check:function(e,r,t){var n,i=document.getElementsByName(e),o=this;setTimeout(function(){for(var e=0;e<i.length;e++)if(i[e]._verifyScope){var a=o.scope(i[e].name),l=a.ngVerify.elems;if(n=checkAll(l),void 0===t||t===!0||void 0===r)for(var s=n.errEls,c=0;c<s.length;c++)makeError(s[c],!0)}"function"==typeof r&&r(n.errEls)})},setError:function(e,r){var t;return t="object"==typeof e?e:document.getElementById(e),null==t&&angular.forEach(document.getElementsByName(e),function(e){return void 0!==angular.element(e).attr("ng-verify")?(t=e,!1):void 0}),null==t?console.error("param:'"+e+"' cant find dom element"):(t._verifySetError=r,t.focus(),void setTimeout(function(){t.blur()}))}}}),m.directive("verifyScope",function(){return{scope:{},controller:["$scope","$element","$attrs",function(e,r,t){this.getscope=function(){return e},e.ngVerify={elems:[],subBtn:[],tipStyle:formatOpt(t.verifyScope,r).tipStyle,submit:function(){for(var r=e.ngVerify.elems,t=checkAll(r),n=0;n<t.errEls.length;n++)makeError(t.errEls[n],!0)}},r[0]._verifyScope=e}],link:function(e,r){r.attr("novalidate","novalidate")}}}),m.directive("ngVerify",["ngVerify",function(e){return{require:"?^verifyScope",scope:!1,link:function(r,t,n,i){var o,a=formatOpt(n.ngVerify,t);if(void 0!=i)o=i.getscope();else{if(!a.control)return console.error("ngVerify need control option to form.name:"),void console.error(t);if(o=e.scope(a.control),void 0==o)return console.error("ngVerify button cant be find parent form:"),void console.error(t)}t.ngVerify={$scope:o,scope:r,iAttrs:n,OPTS:a},Init(t)}}}])}(angular);